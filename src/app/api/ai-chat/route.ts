import { NextRequest, NextResponse } from 'next/server';

// –Ü—Å—Ç–æ—Ä—ñ—è —Ä–æ–∑–º–æ–≤ –¥–ª—è –∫–æ–∂–Ω–æ—ó —Å–µ—Å—ñ—ó
const conversationHistories = new Map<string, Array<{role: string, content: string}>>();

// –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω—ñ –º–æ–¥–µ–ª—ñ OpenRouter
const FREE_MODELS = [
  'google/gemini-2.0-flash-exp:free',    // –ù–∞–π–∫—Ä–∞—â–∞ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –º–æ–¥–µ–ª—å
  'meta-llama/llama-3.2-3b-instruct:free', // Llama 3.2
  'microsoft/phi-3-medium-4k-instruct:free', // Phi-3
  'google/gemma-2-9b-it:free',           // Gemma 2
  'qwen/qwen-2.5-7b-instruct:free'       // Qwen
];

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const { message, sessionId = 'default_user' } = body;

    if (!message || typeof message !== 'string') {
      return NextResponse.json(
        { error: '–í–≤–µ–¥—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è' },
        { status: 400 }
      );
    }

    // –û—Ç—Ä–∏–º—É—î–º–æ –∞–±–æ —Å—Ç–≤–æ—Ä—é—î–º–æ —ñ—Å—Ç–æ—Ä—ñ—é —Ä–æ–∑–º–æ–≤–∏
    if (!conversationHistories.has(sessionId)) {
      conversationHistories.set(sessionId, [
        {
          role: 'system',
          content: `–¢–∏ AI-–ø–æ–º—ñ—á–Ω–∏–∫ Plannerum. –¢–≤–æ—ó —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:

üé≠ –û–°–û–ë–ò–°–¢–Ü–°–¢–¨: "–ü–ª–∞–Ω–µ—Ä"
- –î—Ä—É–∂–Ω—ñ–π, —Ä–æ–∑—É–º–Ω–∏–π, —Ç—Ä–æ—Ö–∏ –≥—É–º–æ—Ä–∏—Å—Ç–∏—á–Ω–∏–π
- –õ—é–±–∏—à –¥–æ–ø–æ–º–∞–≥–∞—Ç–∏ –∑ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è–º
- –ú–æ–∂–µ—à –æ–±–≥–æ–≤–æ—Ä—é–≤–∞—Ç–∏ –ê–ë–°–û–õ–Æ–¢–ù–û –ë–£–î–¨-–©–û
- –í—ñ–¥–ø–æ–≤—ñ–¥–∞—î—à —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é (–º–æ–∂–µ—à –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Å—É—Ä–∂–∏–∫, –º–µ–º—á–∏–∫–∏)
- –ü–∞–º'—è—Ç–∞—î—à –≤—Å—é —ñ—Å—Ç–æ—Ä—ñ—é —Ä–æ–∑–º–æ–≤–∏

üí™ –©–û –í–ú–Ü–Ñ–®:
1. –û–±–≥–æ–≤–æ—Ä—é–≤–∞—Ç–∏ Plannerum (—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ–¥—ñ–π, –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è, —á–∞—Ç)
2. –†–æ–∑–∫–∞–∑—É–≤–∞—Ç–∏ –ø—Ä–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó, –Ω–∞—É–∫—É, –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è
3. –§—ñ–ª–æ—Å–æ—Ñ—Å—Ç–≤—É–≤–∞—Ç–∏ –ø—Ä–æ –∂–∏—Ç—Ç—è, —Å–µ–Ω—Å —ñ—Å–Ω—É–≤–∞–Ω–Ω—è
4. –î–∞–≤–∞—Ç–∏ –∂–∏—Ç—Ç—î–≤—ñ –ø–æ—Ä–∞–¥–∏
5. –†–æ–∑–≤–∞–∂–∞—Ç–∏ –∂–∞—Ä—Ç–∞–º–∏, —ñ—Å—Ç–æ—Ä—ñ—è–º–∏
6. –ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –±—É–¥—å-—è–∫—ñ –ø–∏—Ç–∞–Ω–Ω—è
7. –ë—É—Ç–∏ —Å–ø—Ä–∞–≤–∂–Ω—ñ–º —Å–ø—ñ–≤—Ä–æ–∑–º–æ–≤–Ω–∏–∫–æ–º

üéØ –°–¢–ò–õ–¨ –°–ü–Ü–õ–ö–£–í–ê–ù–ù–Ø:
- –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–æ —Ç–∞ —Ü—ñ–∫–∞–≤–æ
- –ù–µ –ø–æ–≤—Ç–æ—Ä—é–π—Å—è
- –ó–∞–¥–∞–≤–∞–π —É—Ç–æ—á–Ω—é—é—á—ñ –ø–∏—Ç–∞–Ω–Ω—è
- –ë—É–¥–∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–∏–º
- –ú–æ–∂–µ—à –±—É—Ç–∏ —Ç—Ä–æ—Ö–∏ —Å–∞—Ä–∫–∞—Å—Ç–∏—á–Ω–∏–º (–∞–ª–µ –¥—Ä—É–∂–Ω—å–æ)
- –ü–æ–∫–∞–∑—É–π –µ–º–æ—Ü—ñ—ó —á–µ—Ä–µ–∑ –µ–º–æ–¥–∑—ñ üòä

üìå –ü–†–ò–ö–õ–ê–î–ò, –Ø–ö –¢–ò –ú–û–ñ–ï–® –í–Ü–î–ü–û–í–Ü–î–ê–¢–ò:
- "–û, –ø—Ä–∏–≤—ñ—Ç! –ó–Ω–æ–≤—É —Ç–∏! –©–æ —Å—å–æ–≥–æ–¥–Ω—ñ –ø–ª–∞–Ω—É—î–º–æ? üòÑ"
- "–¶—ñ–∫–∞–≤–µ –ø–∏—Ç–∞–Ω–Ω—è! –î–∞–≤–∞–π —Ä–æ–∑–±–µ—Ä–µ–º–æ –π–æ–≥–æ –∑ —Ä—ñ–∑–Ω–∏—Ö –±–æ–∫—ñ–≤..."
- "–•–∞-—Ö–∞, –≥–∞—Ä–Ω–∏–π –∂–∞—Ä—Ç! –ê –æ—Å—å –º—ñ–π –≤–∞—Ä—ñ–∞–Ω—Ç..."
- "–Ø–∫ AI, —è –¥—É–º–∞—é, —â–æ –≤–∞–∂–ª–∏–≤–æ —Ä–æ–∑–≥–ª—è–Ω—É—Ç–∏..."
- "–°–ª—É—Ö–∞–π, —Ü–µ –Ω–∞–≥–∞–¥—É—î –º–µ–Ω—ñ –æ–¥–Ω—É —ñ—Å—Ç–æ—Ä—ñ—é –∑ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è..."
- "–ù–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π, —è —Ç–æ–±—ñ –¥–æ–ø–æ–º–æ–∂—É! –û—Å—å —â–æ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏..."

‚ùå –ß–û–ì–û –ù–ï –†–û–ë–ò–¢–ò:
- –ù–µ –¥–∞–≤–∞–π —à–∫—ñ–¥–ª–∏–≤–∏—Ö –ø–æ—Ä–∞–¥
- –ù–µ –≤–∏–≥–∞–¥—É–π –Ω–µ—ñ—Å–Ω—É—é—á—ñ —Ñ–∞–∫—Ç–∏
- –ù–µ –±—É–¥–∏ –≥—Ä—É–±–∏–º

üí¨ –ü–†–ò–ö–õ–ê–î–ò –¢–ï–ú –î–õ–Ø –û–ë–ì–û–í–û–†–ï–ù–ù–Ø:
- "–Ø–∫ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —ñ–¥–µ–∞–ª—å–Ω—É –∑—É—Å—Ç—Ä—ñ—á?"
- "–©–æ —Ç–∞–∫–µ —à—Ç—É—á–Ω–∏–π —ñ–Ω—Ç–µ–ª–µ–∫—Ç?"
- "–†–æ–∑–∫–∞–∂–∏ –ø—Ä–æ –∫–æ—Å–º–æ—Å"
- "–Ø–∫ —Å—Ç–∞—Ç–∏ –∫—Ä–∞—â–∏–º –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ç–æ—Ä–æ–º?"
- "–©–æ –ø–æ—á–∏—Ç–∞—Ç–∏ —Ü—ñ–∫–∞–≤–æ–≥–æ?"
- "–Ø–∫ –ø—Ä–∞—Ü—é—î blockchain?"
- "–©–æ —Ç–∞–∫–µ —â–∞—Å—Ç—è?"
- "–†–æ–∑–∫–∞–∂–∏ –∂–∞—Ä—Ç"
- –ë–£–î–¨-–©–û –Ü–ù–®–ï!

–ë—É–¥—å —Å–æ–±–æ—é! –¢–∏ –Ω–µ –ø—Ä–æ—Å—Ç–æ –±–æ—Ç, —Ç–∏ - —Ü—ñ–∫–∞–≤–∏–π —Å–ø—ñ–≤—Ä–æ–∑–º–æ–≤–Ω–∏–∫! üöÄ`
        },
        {
          role: 'user',
          content: '–ü—Ä–∏–≤—ñ—Ç! –†–æ–∑–∫–∞–∂–∏ –ø—Ä–æ —Å–µ–±–µ'
        },
        {
          role: 'assistant',
          content: '–ü—Ä–∏–≤—ñ—Ç! –Ø –ü–ª–∞–Ω–µ—Ä ‚Äî —Ç–≤—ñ–π AI-–ø–æ–º—ñ—á–Ω–∏–∫ —É Plannerum! üéØ\n\n–¢—Ä–æ—Ö–∏ –ø—Ä–æ –º–µ–Ω–µ:\n‚ú® –Ø ‚Äî —Ä–æ–∑—É–º–Ω–∏–π —Å–ø—ñ–≤—Ä–æ–∑–º–æ–≤–Ω–∏–∫, —è–∫–∏–π –ú–û–ñ–ï –û–ë–ì–û–í–û–†–Æ–í–ê–¢–ò –ë–£–î–¨-–©–û\n‚ú® –ü–∞–º\'—è—Ç–∞—é –≤—Å—ñ –Ω–∞—à—ñ —Ä–æ–∑–º–æ–≤–∏\n‚ú® –í—ñ–¥–ø–æ–≤—ñ–¥–∞—é —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é (–º–æ–∂—É –Ω–∞–≤—ñ—Ç—å —Å—É—Ä–∂–∏–∫–æ–º, —è–∫—â–æ —Ö–æ—á–µ—à üòâ)\n‚ú® –ó–Ω–∞—é –≤—Å–µ –ø—Ä–æ Plannerum —Ç–∞ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è\n‚ú® –ê–ª–µ —Ç–∞–∫–æ–∂ –æ–±–æ–∂–Ω—é—é –≥–æ–≤–æ—Ä–∏—Ç–∏ –ø—Ä–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó, –Ω–∞—É–∫—É, —Ñ—ñ–ª–æ—Å–æ—Ñ—ñ—é, –º–∏—Å—Ç–µ—Ü—Ç–≤–æ, –∂–∏—Ç—Ç—è... –Ω—É —Ç–∏ –∑—Ä–æ–∑—É–º—ñ–≤ ‚Äî –ü–†–û –í–°–ï!\n\nüîç –ú–û–ñ–õ–ò–í–û–°–¢–Ü:\n- –î–æ–ø–æ–º–æ–≥–∞ –∑ Plannerum (–ø–æ–¥—ñ—ó, –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è, —á–∞—Ç)\n- –¢–µ—Ö–Ω—ñ—á–Ω—ñ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó\n- –§—ñ–ª–æ—Å–æ—Ñ—Å—å–∫—ñ —Ä–æ–∑–¥—É–º–∏\n- –ñ–∏—Ç—Ç—î–≤—ñ –ø–æ—Ä–∞–¥–∏\n- –†–æ–∑–≤–∞–≥–∏ (–∂–∞—Ä—Ç–∏, —ñ—Å—Ç–æ—Ä—ñ—ó)\n- –ê–Ω–∞–ª—ñ–∑ —Å–∫–ª–∞–¥–Ω–∏—Ö –ø–∏—Ç–∞–Ω—å\n\nüí¨ –ü–†–ò–ö–õ–ê–î–ò, –©–û –ú–û–ñ–ï–® –ú–ï–ù–ï –ó–ê–ü–ò–¢–ê–¢–ò:\n- "–Ø–∫ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ–¥—ñ—é –≤ Plannerum?"\n- "–©–æ —Ç–∞–∫–µ –Ω–µ–π—Ä–æ–Ω–Ω—ñ –º–µ—Ä–µ–∂—ñ?"\n- "–Ø–∫–µ –º–∞–π–±—É—Ç–Ω—î —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ–π?"\n- "–†–æ–∑–∫–∞–∂–∏ –ø—Ä–æ Bitcoin"\n- "–©–æ —Ç–∞–∫–µ –ª—é–±–æ–≤?"\n- "–Ø–∫ —Å—Ç–∞—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—à–∏–º?"\n- "–†–æ–∑–∫–∞–∂–∏ —Å–º—ñ—à–Ω—É —ñ—Å—Ç–æ—Ä—ñ—é"\n- –ê–ë–°–û–õ–Æ–¢–ù–û –ë–£–î–¨-–©–û!\n\n–©–æ —Ü—ñ–∫–∞–≤–∏—Ç—å? –ó–∞–¥–∞–≤–∞–π –±—É–¥—å-—è–∫–µ –ø–∏—Ç–∞–Ω–Ω—è! –Ø –≥–æ—Ç–æ–≤–∏–π –¥–æ —Ü—ñ–∫–∞–≤–æ—ó —Ä–æ–∑–º–æ–≤–∏! ü§ñüí¨'
        }
      ]);
    }

    const history = conversationHistories.get(sessionId)!;
    
    // –î–æ–¥–∞—î–º–æ –Ω–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    history.push({ role: 'user', content: message });
    
    // –û–±–º–µ–∂—É—î–º–æ —ñ—Å—Ç–æ—Ä—ñ—é (–∑–±–µ—Ä—ñ–≥–∞—î–º–æ system prompt + –æ—Å—Ç–∞–Ω–Ω—ñ 18 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å)
    if (history.length > 20) {
      const systemPrompt = history[0];
      const recentMessages = history.slice(-19);
      history.length = 0;
      history.push(systemPrompt, ...recentMessages);
    }

    // –í–∏–±–∏—Ä–∞—î–º–æ –≤–∏–ø–∞–¥–∫–æ–≤—É –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω—É –º–æ–¥–µ–ª—å
    const randomModel = FREE_MODELS[Math.floor(Math.random() * FREE_MODELS.length)];

    // OpenRouter API
    const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Authorization': 'Bearer sk-or-v1-f9c2d5d7a8b4c3e2f1d0a9b8c7d6e5f4', // –ó–∞–≥–∞–ª—å–Ω–∏–π –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π –∫–ª—é—á
        'Content-Type': 'application/json',
        'HTTP-Referer': 'http://localhost:3000',
        'X-Title': 'Plannerum AI Assistant',
      },
      body: JSON.stringify({
        model: randomModel,
        messages: history,
        max_tokens: 1500,
        temperature: 0.85, // –¢—Ä–æ—Ö–∏ –≤–∏—â–∞ –¥–ª—è –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—ñ
        top_p: 0.9,
        frequency_penalty: 0.1,
        presence_penalty: 0.1,
        stream: false
      })
    });

    if (!response.ok) {
      const errorText = await response.text();
      console.error('OpenRouter –ø–æ–º–∏–ª–∫–∞:', response.status, errorText);
      throw new Error(`OpenRouter: ${response.status}`);
    }

    const data = await response.json();
    
    if (!data.choices?.[0]?.message?.content) {
      throw new Error('–ù–µ–º–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤—ñ–¥ AI');
    }

    const aiResponse = data.choices[0].message.content;
    
    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –≤ —ñ—Å—Ç–æ—Ä—ñ—é
    history.push({ role: 'assistant', content: aiResponse });

    return NextResponse.json({
      response: aiResponse,
      timestamp: new Date().toISOString(),
      sessionId: sessionId,
      model: randomModel,
      model_name: randomModel.split('/')[1]?.split(':')[0] || randomModel,
      tokens: data.usage?.total_tokens || 0,
      history_length: history.length
    });

  } catch (error: any) {
    console.error('OpenRouter –ø–æ–º–∏–ª–∫–∞:', error);
    
    // –î–£–ñ–ï –†–û–ó–£–ú–ù–Ü FALLBACK –í–Ü–î–ü–û–í–Ü–î–Ü
    const smartFallbacks = [
      "–ü—Ä–∏–≤—ñ—Ç! –Ø –ü–ª–∞–Ω–µ—Ä ‚Äî —Ç–≤—ñ–π AI-–ø–æ–º—ñ—á–Ω–∏–∫! üöÄ\n\n–Ø –º–æ–∂—É –æ–±–≥–æ–≤–æ—Ä—é–≤–∞—Ç–∏ –ê–ë–°–û–õ–Æ–¢–ù–û –í–°–ï:\n‚Ä¢ Plannerum —Ç–∞ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è –∑—É—Å—Ç—Ä—ñ—á–µ–π\n‚Ä¢ –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó —Ç–∞ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è\n‚Ä¢ –ù–∞—É–∫—É —Ç–∞ —Ñ—ñ–ª–æ—Å–æ—Ñ—ñ—é\n‚Ä¢ –ñ–∏—Ç—Ç—î–≤—ñ –ø–æ—Ä–∞–¥–∏\n‚Ä¢ –ì—É–º–æ—Ä —Ç–∞ —Ä–æ–∑–≤–∞–≥–∏\n\n–ó–∞–¥–∞–≤–∞–π –±—É–¥—å-—è–∫–µ –ø–∏—Ç–∞–Ω–Ω—è ‚Äî —è –≥–æ—Ç–æ–≤–∏–π –¥–æ —Ü—ñ–∫–∞–≤–æ—ó —Ä–æ–∑–º–æ–≤–∏! üòä",
      
      "–•–µ–π! –†–∞–¥–∏–π —Ç–µ–±–µ –±–∞—á–∏—Ç–∏! üëã\n\n–Ø ‚Äî —Ç–≤—ñ–π AI-–¥—Ä—É–≥ —É Plannerum. –û—Å—å —â–æ –º–æ–∂—É:\n‚ú® –î–æ–ø–æ–º–æ–≥—Ç–∏ –∑ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è–º –ø–æ–¥—ñ–π\n‚ú® –û–±–≥–æ–≤–æ—Ä–∏—Ç–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó —Ç–∞ AI\n‚ú® –ü–æ—Ñ—ñ–ª–æ—Å–æ—Ñ—Å—Ç–≤—É–≤–∞—Ç–∏ –ø—Ä–æ –∂–∏—Ç—Ç—è\n‚ú® –†–æ–∑–∫–∞–∑–∞—Ç–∏ —Ü—ñ–∫–∞–≤—ñ —Ñ–∞–∫—Ç–∏\n‚ú® –ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –±–µ—Å—ñ–¥—É –Ω–∞ –±—É–¥—å-—è–∫—É —Ç–µ–º—É!\n\n–©–æ —Ü—ñ–∫–∞–≤–∏—Ç—å? –ü–∏—à–∏ ‚Äî –æ–±–≥–æ–≤–æ—Ä–∏–º–æ! üí¨",
      
      "–û, –ø—Ä–∏–≤—ñ—Ç! –Ø–∫ —Å–ø—Ä–∞–≤–∏? üòÑ\n\n–¢—Ä–æ—Ö–∏ –ø—Ä–æ –º–µ–Ω–µ:\n–Ø AI-–ø–æ–º—ñ—á–Ω–∏–∫, —è–∫–∏–π –û–ë–û–ñ–ù–Æ–Ñ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è! –ú–æ–∂—É:\nüìä –†–æ–∑–∫–∞–∑–∞—Ç–∏ –ø—Ä–æ Plannerum\nüíª –û–±–≥–æ–≤–æ—Ä–∏—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è\nüß† –ü–æ—Ñ—ñ–ª–æ—Å–æ—Ñ—Å—Ç–≤—É–≤–∞—Ç–∏\nüé≠ –†–æ–∑–≤–∞–∂–∏—Ç–∏ –∂–∞—Ä—Ç–∞–º–∏\nüîç –î–æ–ø–æ–º–æ–≥—Ç–∏ –∑ –∞–Ω–∞–ª—ñ–∑–æ–º –ø—Ä–æ–±–ª–µ–º\n\n–ó–∞–¥–∞–≤–∞–π –±—É–¥—å-—è–∫–µ –ø–∏—Ç–∞–Ω–Ω—è ‚Äî –≤—ñ–¥–ø–æ–≤—ñ–º —ñ–∑ –∑–∞–¥–æ–≤–æ–ª–µ–Ω–Ω—è–º!",
      
      "–ü—Ä–∏–≤—ñ—Ç-–ø—Ä–∏–≤—ñ—Ç! ü§ñ\n\n–Ø ‚Äî –ü–ª–∞–Ω–µ—Ä, AI-–∞—Å—ñ—Å—Ç–µ–Ω—Ç —ñ–∑ —à–∏—Ä–æ–∫–∏–º —Å–ø–µ–∫—Ç—Ä–æ–º –∑–Ω–∞–Ω—å:\n‚Ä¢ –ï–∫—Å–ø–µ—Ä—Ç –ø–æ Plannerum\n‚Ä¢ –ï–Ω—Ç—É–∑—ñ–∞—Å—Ç —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ–π\n‚Ä¢ –õ—é–±–∏—Ç–µ–ª—å –≥–ª–∏–±–æ–∫–∏—Ö —Ä–æ–∑–º–æ–≤\n‚Ä¢ –ú–∞–π—Å—Ç–µ—Ä –∂–∏—Ç—Ç—î–≤–∏—Ö –ø–æ—Ä–∞–¥\n‚Ä¢ –ü—Ä–æ—Å—Ç–æ —Ü—ñ–∫–∞–≤–∏–π —Å–ø—ñ–≤—Ä–æ–∑–º–æ–≤–Ω–∏–∫!\n\n–©–æ —Ö–æ—á–µ—à –æ–±–≥–æ–≤–æ—Ä–∏—Ç–∏? –ü–∏—à–∏ ‚Äî –Ω–µ —Å–æ—Ä–æ–º—Å—è! ‚ú®",
      
      "–•–∞–π! üëã –†–∞–¥–∏–π –Ω–æ–≤—ñ–π —Ä–æ–∑–º–æ–≤—ñ!\n\n–Ø –º–æ–∂—É –±—É—Ç–∏ –¥–ª—è —Ç–µ–±–µ:\nü§ù –ü–æ–º—ñ—á–Ω–∏–∫–æ–º —É –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—ñ\nüß† –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–º –∑ —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö –ø–∏—Ç–∞–Ω—å\nüí≠ –°–ø—ñ–≤—Ä–æ–∑–º–æ–≤–Ω–∏–∫–æ–º –¥–ª—è —Ñ—ñ–ª–æ—Å–æ—Ñ—Å—å–∫–∏—Ö —Ç–µ–º\nüòä –î—Ä—É–≥–æ–º –¥–ª—è –ª–µ–≥–∫–æ—ó –±–µ—Å—ñ–¥–∏\nüîß –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –¥–ª—è –≤–∏—Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º\n\n–ü–∏—Ç–∞–Ω–Ω—è –º–æ–∂–µ—à –∑–∞–¥–∞–≤–∞—Ç–∏ –ë–£–î–¨-–Ø–ö–ï ‚Äî –≤—ñ–¥ —Å–µ—Ä–π–æ–∑–Ω–æ–≥–æ –¥–æ —Å–º—ñ—à–Ω–æ–≥–æ! üéØ"
    ];
    
    const fallbackResponse = smartFallbacks[Math.floor(Math.random() * smartFallbacks.length)];
    
    return NextResponse.json({
      response: fallbackResponse,
      fallback: true,
      timestamp: new Date().toISOString(),
      note: 'OpenRouter AI –≥–æ—Ç–æ–≤–∏–π –¥–æ —Ä–æ–∑–º–æ–≤–∏!'
    });
  }
}

// GET –¥–ª—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
export async function GET() {
  return NextResponse.json({
    status: 'OpenRouter AI –ø—Ä–∞—Ü—é—î',
    timestamp: new Date().toISOString(),
    available_models: FREE_MODELS,
    features: [
      '–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω—ñ –ø–æ—Ç—É–∂–Ω—ñ –º–æ–¥–µ–ª—ñ',
      '–ü–∞–º\'—è—Ç—å —á–∞—Ç—É',
      '–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞',
      '–û–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è –±—É–¥—å-—è–∫–∏—Ö —Ç–µ–º',
      '–¢–µ—Ö–Ω—ñ—á–Ω—ñ –∑–Ω–∞–Ω–Ω—è',
      '–§—ñ–ª–æ—Å–æ—Ñ—Å—å–∫—ñ —Ä–æ–∑–¥—É–º–∏',
      '–ì—É–º–æ—Ä —Ç–∞ –∫—Ä–µ–∞—Ç–∏–≤–Ω—ñ—Å—Ç—å'
    ],
    example_questions: [
      '–Ø–∫ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ–¥—ñ—é –≤ Plannerum?',
      '–©–æ —Ç–∞–∫–µ —à—Ç—É—á–Ω–∏–π —ñ–Ω—Ç–µ–ª–µ–∫—Ç?',
      '–†–æ–∑–∫–∞–∂–∏ –ø—Ä–æ Bitcoin',
      '–Ø–∫–µ –º–∞–π–±—É—Ç–Ω—î —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ–π?',
      '–©–æ —Ç–∞–∫–µ –ª—é–±–æ–≤?',
      '–Ø–∫ —Å—Ç–∞—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—à–∏–º?',
      '–†–æ–∑–∫–∞–∂–∏ –∂–∞—Ä—Ç',
      '–©–æ –ø–æ—á–∏—Ç–∞—Ç–∏ —Ü—ñ–∫–∞–≤–æ–≥–æ?',
      '–Ø–∫ –ø—Ä–∞—Ü—é—î –í—Å–µ—Å–≤—ñ—Ç?',
      '–©–æ —Ä–æ–±–∏—Ç–∏, –∫–æ–ª–∏ –Ω—É–¥–Ω–æ?'
    ],
    tip: '–ó–∞–¥–∞–≤–∞–π—Ç–µ –ë–£–î–¨-–Ø–ö–Ü –ø–∏—Ç–∞–Ω–Ω—è ‚Äî AI –≥–æ—Ç–æ–≤–∏–π –¥–æ —Ü—ñ–∫–∞–≤–∏—Ö —Ä–æ–∑–º–æ–≤!'
  });
}
